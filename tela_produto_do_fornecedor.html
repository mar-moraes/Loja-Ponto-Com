<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Novo Produto</title>

  <link rel="stylesheet" href="estilos/style.css"/>
  <link rel="stylesheet" href="estilos/estilo_carrinho.css">
  <link rel="stylesheet" href="estilos/estilo_produto.css">

  <style>
    /* Estiliza os inputs de NOME da caracter√≠stica */
    .caracteristica-item input[name="caracteristica_nome[]"] {
      font-weight: 500;
      color: #333;
      background-color: transparent; /* Tira o fundo do input */
      border: none; /* Tira a borda */
      padding: 12px 16px; /* Mant√©m o padding original */
      font-size: 1em; /* Mant√©m o tamanho da fonte */
      font-family: inherit; /* Mant√©m a fonte */
      width: 100%; /* Ocupa o espa√ßo */
      box-sizing: border-box;
    }
    
    /* --- IN√çCIO DA MODIFICA√á√ÉO CSS --- */

    /* Estiliza os inputs de VALOR da caracter√≠stica */
    .caracteristica-item input[name="caracteristica_valor[]"] {
      border: none;
      background-color: transparent;
      padding: 12px 16px;
      font-size: 1em;
      font-family: inherit;
      width: 100%;
      box-sizing: border-box;
      /* Adiciona espa√ßo √† direita para o √≠cone n√£o sobrepor o texto */
      padding-right: 40px; 
    }
    
    /* Adiciona foco para saber onde est√° digitando */
    .caracteristica-item input:focus {
      outline: 1px solid #2968C8; /* Borda azul ao focar */
      background-color: #fff;
    }

    /* Define o item como 'relative' para posicionar o √≠cone dentro dele */
    .caracteristica-item {
      position: relative;
    }

    /* Estilo do √≠cone de lixeira */
    .btn-delete-caracteristica {
      position: absolute;
      right: 12px; /* Alinha com o padding do input */
      top: 50%;
      transform: translateY(-50%);
      display: none; /* Escondido por padr√£o */
      cursor: pointer;
      font-size: 1.2em;
      opacity: 0.6;
      user-select: none; /* Impede de selecionar o emoji */
    }

    /* Mostra o √≠cone quando o mouse passa sobre o item */
    .caracteristica-item:hover .btn-delete-caracteristica {
      display: block;
    }

    .btn-delete-caracteristica:hover {
      opacity: 1;
    }
    /* --- FIM DA MODIFICA√á√ÉO CSS --- */


    /* --- IN√çCIO CSS ESPECIFICA√á√ïES R√ÅPIDAS (NOVO) --- */
    #especificacoes-rapidas-lista .espec-item {
      position: relative;
      border-bottom: 1px solid #eee;
    }

    #especificacoes-rapidas-lista input[name="especificacao_rapida[]"] {
      border: none;
      background-color: transparent;
      padding: 12px 16px;
      font-size: 1em;
      font-family: inherit;
      width: 100%;
      box-sizing: border-box;
      padding-right: 40px; /* Espa√ßo para lixeira */
    }
    
    #especificacoes-rapidas-lista input:focus {
      outline: 1px solid #2968C8; 
      background-color: #fff;
    }

    #especificacoes-rapidas-lista .btn-delete-espec {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      display: none; 
      cursor: pointer;
      font-size: 1.2em;
      opacity: 0.6;
      user-select: none;
    }

    #especificacoes-rapidas-lista .espec-item:hover .btn-delete-espec {
      display: block;
    }

    #especificacoes-rapidas-lista .btn-delete-espec:hover {
      opacity: 1;
    }
    /* --- FIM CSS ESPECIFICA√á√ïES R√ÅPIDAS (NOVO) --- */

  </style>
</head>
<body>
    <header class="topbar">
      <nav class="actions"> 
        <div class="logo-container"> 
            <a href="index.php" style="display: flex; align-items: center;">
              <img src="imagens/exemplo-logo.png" alt="" style="width: 40px; height: 40px;">
            </a>
          </div> 
        
        <form action="buscar.php" method="GET" style="position: relative; width: 600px; max-width: 100%;">
          
          <input type="search" id="pesquisa" name="q" placeholder="Digite sua pesquisa..." style="font-size: 16px; width: 100%; height: 40px; padding-left: 15px; padding-right: 45px; border-radius: 6px; border: none; box-sizing: border-box;">
          
          <button type="submit" style="position: absolute; right: 0; top: 0; height: 40px; width: 45px; border: none; background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <img src="imagens/lupa.png" alt="lupa" style="width: 28px; height: 28px; opacity: 0.6;">
          </button>
        </form>
        
        <div style="display: flex; gap: 30px; align-items: center;">
          <a href="#">Crie a sua conta</a>
          <a href="#">Entre</a>
          <a href="tela_carrinho.html" style="display: flex; align-items: center; gap: 5px;">
            Carrinho
            <img src="imagens/carrinho invertido.png" alt="" style="width: 20px; height: 20px;">
          </a>
        </div>
      </nav>
    </header>

    <form id="form-produto">

      <main class="produto-container" 
      data-title="" 
      data-price="" 
      data-img="">
  
      <div class="coluna-galeria" style="flex: 1.2;">
        
        <input type="file" id="produto-imagens" multiple accept="image/*" style="display: none;">

        <div style="display: flex; gap: 15px; width: 100%; height: 100%;">
            
            <div class="thumbnails" id="thumbnails-container">
              </div>
            
            <div class="imagem-principal-container" style="display: flex; flex-direction: column; flex: 1;">
              
              <label for="produto-imagens" 
                     id="imagem-placeholder" 
                     style="background-color: #f0f0f0; border: 1px dashed #ccc; height: 100%; display: flex; align-items: center; justify-content: center; width: 100%; cursor: pointer; color: #555; text-align: center; box-sizing: border-box;">
                  Clique aqui para selecionar as imagens
              </label>
  
              <img alt="Imagem principal do produto" 
                   id="imagem-principal" 
                   style="border: 1px solid #eee; height: 100%; display: none; width: 100%; object-fit: contain; box-sizing: border-box; max-height: none;">
              
            </div>
        </div>
        
      </div>

      <div class="coluna-info" style="flex: 1;">

        <label for="produto-titulo" style="font-size: 14px; font-weight: 600; color: #333;">T√≠tulo do Produto:</label>
        <input type="text" id="produto-titulo" name="titulo" required style="width: 100%; font-size: 22px; font-weight: 600; padding: 5px; margin-bottom: 20px; box-sizing: border-box;">

        <div style="margin-bottom: 20px;">
          <label for="produto-categoria" style="display: block; margin-bottom: 5px;">Categoria:</label>
          <select id="produto-categoria" name="categoria" required style="width: 100%; padding: 10px; font-size: 16px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px; background: #fff;">
            <option value="">Carregando categorias...</option>
          </select>
        </div>
        <div class="produto-preco" style="display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px;">
          
          <div style="flex: 1; min-width: 150px;">
            <label for="produto-preco" style="display: block; margin-bottom: 5px;">Pre√ßo:</label>
            <input type="number" class="price" id="produto-preco" name="preco" step="0.01" min="0" required placeholder="Ex: 199.90" style="width: 100%; padding: 10px; font-size: 16px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px;">
          </div>

          <div style="flex: 1; min-width: 150px;">
            <label for="produto-badge" style="display: block; margin-bottom: 5px;">Desconto (%):</label>
            <input type="number" class="badge" id="produto-badge" name="desconto" min="0" max="100" placeholder="Opcional" style="width: 100%; padding: 10px; font-size: 16px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px;">
          </div>
          
          <div style="width: 100%; margin-top: 10px;">
            <button type="button" onclick="calcular()" style="padding: 10px 15px; cursor: pointer; border-radius: 6px; border: none; background-color: rgba(41, 104, 200, 0.1); color: #2968C8; font-weight: 600;">
              Calcular desconto
            </button>
          </div>

          <div style="width: 100%; margin-top: 10px; min-height: 40px;">
            <span class="old" id="produto-preco-antigo"></span>
            <span class="price" id="produto-preco-novo"></span>
            <span class="badge" id="produto-badge-display"></span>
          </div>

        </div>
        <div style="margin-bottom: 20px;">
          <label class="label-quantidade" for="produto-quantidade" style="display: block; margin-bottom: 5px;">Quantidade dispon√≠vel:</label>
          <input type="number" id="produto-quantidade" name="quantidade" min="0" placeholder="Ex: 50" required style="width: 100%; padding: 10px; font-size: 16px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 6px;">
        </div>

        
        <script>
          // Script de calcular o desconto (MODIFICADO)
          function calcular() {
            let preco = parseFloat(document.getElementById("produto-preco").value);
            let desconto = parseFloat(document.getElementById("produto-badge").value);
            
            if (isNaN(preco) || preco < 0) {
                alert("Digite um pre√ßo v√°lido.");
                return;
            }
            
            if (isNaN(desconto)) desconto = 0;
            if (desconto < 0) desconto = 0;
            if (desconto > 100) desconto = 100;

            let precoFinal = preco * (1 - desconto / 100);
            
            const formatar = (valor) =>
                valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });

            // Selecionar os 3 elementos
            const precoAntigoEl = document.getElementById("produto-preco-antigo");
            const precoNovoEl = document.getElementById("produto-preco-novo");
            const badgeEl = document.getElementById("produto-badge-display"); // O novo span

            if (desconto > 0) {
                // 1. Pre√ßo antigo (sem "De:")
                precoAntigoEl.textContent = formatar(preco);
                precoAntigoEl.style.display = "inline"; // Garante que apare√ßa

                // 2. Pre√ßo novo (sem "Por:")
                precoNovoEl.textContent = formatar(precoFinal);
                
                // 3. Badge (Ex: 20% OFF)
                badgeEl.textContent = `${desconto}% OFF`;
                badgeEl.style.display = "inline"; // Garante que apare√ßa

            } else {
                // Se n√£o tem desconto, limpa o antigo e o badge
                precoAntigoEl.textContent = "";
                precoAntigoEl.style.display = "none";
                badgeEl.textContent = "";
                badgeEl.style.display = "none";

                // Mostra apenas o pre√ßo normal
                precoNovoEl.textContent = formatar(preco);
            }
            
            localStorage.setItem("precoComDesconto", precoFinal.toFixed(2));
          }

          // Script de salvar rascunho (sem altera√ß√µes, continua no localStorage)
          function salvarRascunho() {
            const produto = obterProdutoFormulario(); // Esta fun√ß√£o ainda √© √∫til
            if (!produto) return;
            const lista = JSON.parse(localStorage.getItem("produtosRascunho")) || [];
            lista.push(produto);
            localStorage.setItem("produtosRascunho", JSON.stringify(lista));
            alert("üíæ Produto salvo como rascunho. Voc√™ poder√° edit√°-lo futuramente.");
          }

          // Fun√ß√£o auxiliar (usada pelo salvarRascunho)
          function obterProdutoFormulario() {
            const titulo = document.getElementById("produto-titulo")?.value || "Produto sem nome";
            const preco = parseFloat(document.getElementById("produto-preco").value);
            const desconto = parseFloat(document.getElementById("produto-badge").value) || 0;
            const quantidade = parseInt(document.getElementById("produto-quantidade").value) || 0;
            const imagem = document.getElementById("imagem-principal").src || "imagens/produto-padrao.png";

            if (isNaN(preco) || preco <= 0) {
                alert("Digite um pre√ßo v√°lido.");
                return null;
            }
            if (quantidade < 0) {
                alert("Quantidade inv√°lida.");
                return null;
            }
            const precoFinal = preco * (1 - desconto / 100);
            return {
                id: Date.now(),
                titulo,
                preco: preco.toFixed(2),
                desconto: desconto.toFixed(0),
                precoFinal: precoFinal.toFixed(2),
                img: imagem,
                quantidade
            };
          }
        </script>

        <div style="margin-top: auto; display: flex; gap: 10px; padding-top: 20px; border-top: 1px solid #eee;">
          <button type="submit" style="flex: 1; background:#2968C8;color:white;padding:10px 15px;border:none;border-radius:6px;cursor:pointer; font-size: 16px; font-weight: 600;">
            üì§ Enviar Produto
          </button>

          <button type="button" onclick="salvarRascunho()" style="flex: 1; background: rgba(41, 104, 200, 0.1); color: #2968C8; padding: 10px 15px;border:none;border-radius:6px;cursor:pointer; font-size: 16px; font-weight: 600;">
            üíæ Salvar como Rascunho
          </button>
        </div>
      </div> 
    </main>

    <div class="detalhes-produto-container">

      <section id="caracteristicas" class="detalhe-bloco">
        <h2>Caracter√≠sticas principais</h2>
        
        <div class="caracteristicas-tabela">
          <div class="caracteristica-item">
            <input type="text" name="caracteristica_nome[]" value="Marca" required>
            <input type="text" name="caracteristica_valor[]" placeholder="Valor (Ex: Samsung)" required>
            <span class="btn-delete-caracteristica">üóëÔ∏è</span>
          </div>
          <div class="caracteristica-item">
            <input type="text" name="caracteristica_nome[]" value="Linha" required>
            <input type="text" name="caracteristica_valor[]" placeholder="Valor (Ex: Galaxy)" required>
            <span class="btn-delete-caracteristica">üóëÔ∏è</span>
          </div>
          <div class="caracteristica-item">
            <input type="text" name="caracteristica_nome[]" value="Modelo" required>
            <input type="text" name="caracteristica_valor[]" placeholder="Valor (Ex: S24 Ultra)" required>
            <span class="btn-delete-caracteristica">üóëÔ∏è</span>
          </div>
          <div class="caracteristica-item">
            <input type="text" name="caracteristica_nome[]" value="Tipo de alimenta√ß√£o" required>
            <input type="text" name="caracteristica_valor[]" placeholder="Valor (Ex: Bateria)" required>
            <span class="btn-delete-caracteristica">üóëÔ∏è</span>
          </div>
          <div class="caracteristica-item">
            <input type="text" name="caracteristica_nome[]" value="Cor" required>
            <input type="text" name="caracteristica_valor[]" placeholder="Valor (Ex: Preto)" required>
            <span class="btn-delete-caracteristica">üóëÔ∏è</span>
          </div>
        </div>
        <button type="button" id="btn-add-caracteristica" style="background-color: #2968C8; color: #FFFFFF; border: none; border-radius: 6px; padding: 10px 15px; font-weight: 600; cursor: pointer; margin-top: 15px;">
          Adicionar Caracter√≠stica
        </button>

      </section>

      <section id="especificacoes-rapidas" class="detalhe-bloco">
        <h2>O que voc√™ precisa saber sobre este produto</h2>
        
        <div id="especificacoes-rapidas-lista">
          <div class="espec-item">
            <input type="text" name="especificacao_rapida[]" placeholder="Ex: Compat√≠vel com outros conjuntos LEGO" required>
            <span class="btn-delete-espec">üóëÔ∏è</span>
          </div>
          <div class="espec-item">
            <input type="text" name="especificacao_rapida[]" placeholder="Ex: Inclui 3 minifiguras" required>
            <span class="btn-delete-espec">üóëÔ∏è</span>
          </div>
          <div class="espec-item">
            <input type="text" name="especificacao_rapida[]" placeholder="Ex: Recomendado para maiores de 8 anos" required>
            <span class="btn-delete-espec">üóëÔ∏è</span>
          </div>
        </div>
        
        <button type="button" id="btn-add-especificacao" style="background-color: #2968C8; color: #FFFFFF; border: none; border-radius: 6px; padding: 10px 15px; font-weight: 600; cursor: pointer; margin-top: 15px;">
          Adicionar Item
        </button>
      </section>
      <section id="descricao" class="detalhe-bloco">
        <h2>Descri√ß√£o do produto</h2>
        <textarea name="descricao" required style="min-height: 150px; width: 100%;"></textarea>
      </section>

    </div>
  
  </form> 
<script>
// Vari√°vel global para armazenar os arquivos selecionados
let selectedFiles = [];

document.addEventListener('DOMContentLoaded', () => {

    // --- Script para carregar categorias (sem altera√ß√µes) ---
    const selectCategoria = document.getElementById('produto-categoria');
    
    async function carregarCategorias() {
        try {
            const response = await fetch('Banco de dados/buscar_categorias.php');
            if (!response.ok) {
                throw new Error('Falha de rede ao buscar categorias.');
            }
            const data = await response.json();
            if (data.sucesso && data.categorias.length > 0) {
                selectCategoria.innerHTML = '<option value="">Selecione uma categoria</option>'; 
                data.categorias.forEach(categoria => {
                    const option = document.createElement('option');
                    option.value = categoria.id;
                    option.textContent = categoria.nome;
                    selectCategoria.appendChild(option);
                });
            } else {
                selectCategoria.innerHTML = '<option value="">Nenhuma categoria encontrada</option>';
                console.warn(data.mensagem || 'Nenhuma categoria retornada do BD.');
            }
        } catch (error) {
            console.error('Erro ao buscar categorias:', error);
            selectCategoria.innerHTML = '<option value="">Erro ao carregar categorias</option>';
        }
    }
    carregarCategorias();
    // --- Fim do script de categorias ---


    
    // =======================================================
    // --- IN√çCIO DA REESCRITA (CORRE√á√ÉO DO BUG) ---
    // =======================================================
    // --- Script de Upload de Imagem (CORRIGIDO) ---
    const fileInput = document.getElementById('produto-imagens');
    const mainImage = document.getElementById('imagem-principal');
    const imagePlaceholder = document.getElementById('imagem-placeholder'); // <-- ADICIONADO
    const thumbnailsContainer = document.getElementById('thumbnails-container');
    const formProduto = document.getElementById('form-produto');

    fileInput.addEventListener('change', (e) => {
        const files = e.target.files;
        
        if (files.length === 0) {
            // Se o usu√°rio cancelar a sele√ß√£o, limpa tudo
            selectedFiles = []; 
            mainImage.src = ""; 
            
            // --- MODIFICADO ---
            // Esconde a imagem e mostra o placeholder
            mainImage.style.display = 'none'; 
            imagePlaceholder.style.display = 'flex'; 
            
            thumbnailsContainer.innerHTML = ''; 
            return;
        }
        
        selectedFiles = Array.from(files); 

        // 1. Carrega a IMAGEM PRINCIPAL (sempre o primeiro arquivo)
        const firstFile = selectedFiles[0];
        const readerMain = new FileReader();
        readerMain.onload = (ev) => {
            mainImage.src = ev.target.result;
            mainImage.alt = "Imagem principal do produto";
            
            // --- MODIFICADO ---
            // Esconde o placeholder e mostra a imagem
            imagePlaceholder.style.display = 'none';
            mainImage.style.display = 'block';
        };
        readerMain.readAsDataURL(firstFile);

        // 2. Carrega TODAS as imagens como thumbnails
        thumbnailsContainer.innerHTML = ''; 
        
        selectedFiles.forEach((file, index) => {
            const readerThumb = new FileReader();
            const thumbImg = document.createElement('img');
            thumbImg.alt = `Thumbnail ${index + 1}`;
            thumbImg.classList.add('thumb-img');

            if (index === 0) {
                thumbImg.classList.add('active');
            }
            
            readerThumb.onload = (ev) => {
                thumbImg.src = ev.target.result; 
            };
            
            thumbImg.addEventListener('click', () => {
                mainImage.src = thumbImg.src; 
                thumbnailsContainer.querySelectorAll('.thumb-img').forEach(t => t.classList.remove('active'));
                thumbImg.classList.add('active');
            });

            thumbnailsContainer.appendChild(thumbImg);
            readerThumb.readAsDataURL(file); 
        });
        
    });
    // --- Fim do script de Upload de Imagem ---

        // 2. Carrega TODAS as imagens como thumbnails
        thumbnailsContainer.innerHTML = ''; 
        
        selectedFiles.forEach((file, index) => {
            const readerThumb = new FileReader();
            const thumbImg = document.createElement('img');
            thumbImg.alt = `Thumbnail ${index + 1}`;
            thumbImg.classList.add('thumb-img');

            // Marca o primeiro como ativo por padr√£o
            if (index === 0) {
                thumbImg.classList.add('active');
            }
            
            // Define o src da thumbnail SOMENTE quando o arquivo for lido
            readerThumb.onload = (ev) => {
                thumbImg.src = ev.target.result; 
            };
            
            // Adiciona o listener para trocar a imagem principal
            thumbImg.addEventListener('click', () => {
                // Ao clicar, a imagem principal usa o src da thumbnail
                mainImage.src = thumbImg.src; 
                
                // Atualiza o 'active' state
                thumbnailsContainer.querySelectorAll('.thumb-img').forEach(t => t.classList.remove('active'));
                thumbImg.classList.add('active');
            });

            thumbnailsContainer.appendChild(thumbImg);
            readerThumb.readAsDataURL(file); // Inicia a leitura do arquivo para esta thumbnail
        });
        
    });
    // --- Fim do script de Upload de Imagem ---
    // =======================================================
    // --- FIM DA REESCRITA ---
    // =======================================================


    // --- Script de Envio do Formul√°rio (sem altera√ß√µes) ---
    formProduto.addEventListener('submit', async (e) => {
        e.preventDefault(); 
        
        if (selectedFiles.length === 0) {
            // Verifica se est√° em modo de edi√ß√£o (se a imagem principal j√° tem um 'src' que n√£o √© um blob)
            const mainImgSrc = document.getElementById('imagem-principal').src;
            if (!mainImgSrc || mainImgSrc.startsWith('blob:')) {
                 alert("Por favor, selecione pelo menos uma imagem para o produto.");
                 return;
            }
            // Se a imagem n√£o √© blob, √© um rascunho salvo, ent√£o pode prosseguir
        }


        const submitButton = formProduto.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        submitButton.textContent = 'Enviando...';

        const formData = new FormData(formProduto);

        // Envia apenas os arquivos NOVOS
        // O back-end precisar√° saber lidar com "nenhuma imagem nova"
        if (selectedFiles.length > 0) {
            formData.append('imagem_principal', selectedFiles[0]);
            
            for (let i = 1; i < selectedFiles.length; i++) {
                formData.append('thumbnails[]', selectedFiles[i]); 
            }
        }
        
        // Adiciona o ID do produto se estiver em modo de edi√ß√£o (para o back-end saber que √© um UPDATE)
        const editarInfo = JSON.parse(localStorage.getItem("editarProduto"));
        if (editarInfo && editarInfo.dados.id_db) { // Assumindo que voc√™ salve o ID do banco
             formData.append('produto_id', editarInfo.dados.id_db);
        }
        

        try {
            const response = await fetch('Banco de dados/processa_novo_produto.php', {
                method: 'POST',
                body: formData 
            });

            const resultado = await response.json();

            // --- IN√çCIO DA CORRE√á√ÉO 3 ---
            if (resultado.sucesso) {
                alert('‚úÖ ' + resultado.mensagem);
                localStorage.removeItem("editarProduto"); // Limpa o rascunho
                window.location.href = 'index.php'; 
            } else {
            // --- FIM DA CORRE√á√ÉO 3 ---
                alert('‚ùå Erro: ' + resultado.mensagem);
            }

        } catch (error) {
            console.error('Erro ao enviar formul√°rio:', error);
            alert('‚ùå Erro de conex√£o. Verifique o console.');
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = 'üì§ Enviar Produto';
        }
    });
    // --- Fim do script de Envio do Formul√°rio ---


</script>

<script>
// Script de Rascunho/Edi√ß√£o (sem altera√ß√µes)
document.addEventListener("DOMContentLoaded", () => {
  const editarInfo = JSON.parse(localStorage.getItem("editarProduto"));

  if (editarInfo) {
    const p = editarInfo.dados;
    document.getElementById("produto-titulo").value = p.titulo;
    document.getElementById("produto-preco").value = p.preco;
    document.getElementById("produto-badge").value = p.desconto;
    document.getElementById("imagem-principal").src = p.img;
    
    const mainImage = document.getElementById("imagem-principal");
    mainImage.alt = "Imagem principal do produto";
    mainImage.style.paddingTop = '0';
    mainImage.style.border = '1px solid #eee';
    mainImage.style.backgroundColor = '#fff';
  }
});

function salvarAlteracoes() {
  const editarInfo = JSON.parse(localStorage.getItem("editarProduto"));
  if (!editarInfo) return;
  const lista = JSON.parse(localStorage.getItem("produtosCadastrados")) || [];
  const novo = obterProdutoFormulario();
  if (!novo) return;
  lista[editarInfo.index] = novo;
  localStorage.setItem("produtosCadastrados", JSON.stringify(lista));
  localStorage.removeItem("editarProduto");
  alert("‚úÖ Produto atualizado com sucesso!");
  window.location.href = "tela_gerenciar_produtos.html";
}
</script>


<script>
// Script de Rascunho/Edi√ß√£o (MODIFICADO)
document.addEventListener("DOMContentLoaded", () => {
  const editarInfo = JSON.parse(localStorage.getItem("editarProduto"));

  if (editarInfo) {
    // --- EST√Å EM MODO DE EDI√á√ÉO ---
    const p = editarInfo.dados;
    document.getElementById("produto-titulo").value = p.titulo;
    document.getElementById("produto-preco").value = p.preco;
    document.getElementById("produto-badge").value = p.desconto;
    
    // --- IN√çCIO DA MODIFICA√á√ÉO (Rascunho) ---
    const mainImage = document.getElementById("imagem-principal");
    const imagePlaceholder = document.getElementById("imagem-placeholder"); // <-- ADICIONADO
    
    mainImage.src = p.img;
    mainImage.alt = "Imagem principal do produto";
    
    // Esconde o placeholder e mostra a imagem
    if (imagePlaceholder) {
        imagePlaceholder.style.display = 'none';
    }
    mainImage.style.display = 'block';
    // --- FIM DA MODIFICA√á√ÉO (Rascunho) ---


    // Encontra o bot√£o "Salvar como Rascunho"
    const btnRascunho = document.querySelector('button[onclick="salvarRascunho()"]');
    if (btnRascunho) {
        // Muda o texto do bot√£o
        btnRascunho.textContent = "üíæ Salvar Altera√ß√µes no Rascunho";
        // MUDA A FUN√á√ÉO que o bot√£o chama
        btnRascunho.setAttribute("onclick", "salvarAlteracoes()");
    }
    // --- FIM DA MODIFICA√á√ÉO ---
  }
});

    if (btnRascunho) {
        // Muda o texto do bot√£o
        btnRascunho.textContent = "üíæ Salvar Altera√ß√µes no Rascunho";
        // MUDA A FUN√á√ÉO que o bot√£o chama
        btnRascunho.setAttribute("onclick", "salvarAlteracoes()");
    }
    // --- FIM DA MODIFICA√á√ÉO ---


// Esta fun√ß√£o √© chamada para SALVAR UM RASCUNHO NOVO
function salvarRascunho() {
  const produto = obterProdutoFormulario(); // obterProdutoFormulario() j√° existe no seu c√≥digo
  if (!produto) return;
  
  // Carrega da lista correta ('produtosCadastrados')
  const lista = JSON.parse(localStorage.getItem("produtosCadastrados")) || [];
  
  lista.push(produto); // Adiciona o novo produto
  
  // Salva na lista correta ('produtosCadastrados')
  localStorage.setItem("produtosCadastrados", JSON.stringify(lista));
  
  alert("üíæ Produto salvo como rascunho. Redirecionando...");
  
  // Redireciona o usu√°rio para a tela de gerenciamento
  window.location.href = "tela_minha_conta.php"; // Modificado para tela_minha_conta.php
}


// Esta fun√ß√£o √© chamada para ATUALIZAR UM RASCUNHO existente
function salvarAlteracoes() {
  const editarInfo = JSON.parse(localStorage.getItem("editarProduto"));
  if (!editarInfo) return;
  
  const lista = JSON.parse(localStorage.getItem("produtosCadastrados")) || [];
  const novo = obterProdutoFormulario(); // obterProdutoFormulario() j√° existe
  if (!novo) return;
  
  lista[editarInfo.index] = novo; // Atualiza o item no √≠ndice correto
  
  localStorage.setItem("produtosCadastrados", JSON.stringify(lista));
  localStorage.removeItem("editarProduto"); // Limpa o modo de edi√ß√£o
  
  alert("‚úÖ Rascunho atualizado com sucesso!");
  
  // Redireciona para a tela de gerenciamento
  window.location.href = "tela_minha_conta.php"; // Modificado para tela_minha_conta.php
}
</script>


<script>
// --- SCRIPT PARA ADICIONAR/REMOVER CARACTER√çSTICAS ---
// (Este script permanece exatamente o mesmo de antes)
document.addEventListener('DOMContentLoaded', function() {
    
    // Seleciona o bot√£o de adicionar e o container das caracter√≠sticas
    const btnAdd = document.getElementById('btn-add-caracteristica');
    const container = document.querySelector('.caracteristicas-tabela');

    // 1. L√≥gica para ADICIONAR
    btnAdd.addEventListener('click', function() {
        const novoItem = document.createElement('div');
        novoItem.className = 'caracteristica-item';
        
        novoItem.innerHTML = `
            <input type="text" name="caracteristica_nome[]" placeholder="Nome (Ex: Material)" required>
            <input type="text" name="caracteristica_valor[]" placeholder="Valor (Ex: Tit√¢nio)" required>
            <span class="btn-delete-caracteristica">üóëÔ∏è</span>
        `;
        
        container.appendChild(novoItem);
    });

    // 2. L√≥gica para REMOVER (Usando Delega√ß√£o de Evento)
    container.addEventListener('click', function(e) {
        
        if (e.target.classList.contains('btn-delete-caracteristica')) {
            
            const itemParaRemover = e.target.closest('.caracteristica-item');
            if (itemParaRemover) {
                itemParaRemover.remove();
            }
        }
    });

});
</script>

<script>
// --- SCRIPT PARA ESPECIFICA√á√ïES R√ÅPIDAS ---
// (Este script permanece exatamente o mesmo de antes)
document.addEventListener('DOMContentLoaded', function() {
    
    // 1. Seleciona os novos elementos
    const btnAddEspec = document.getElementById('btn-add-especificacao');
    const containerEspec = document.getElementById('especificacoes-rapidas-lista');

    // 2. L√≥gica para ADICIONAR
    btnAddEspec.addEventListener('click', function() {
        const novoItem = document.createElement('div');
        novoItem.className = 'espec-item';
        
        novoItem.innerHTML = `
            <input type="text" name="especificacao_rapida[]" placeholder="Novo item" required>
            <span class="btn-delete-espec">üóëÔ∏è</span>
        `;
        
        containerEspec.appendChild(novoItem);
        novoItem.querySelector('input').focus(); 
    });

    // 3. L√≥gica para REMOVER (Usando Delega√ß√£o de Evento)
    containerEspec.addEventListener('click', function(e) {
        
        if (e.target.classList.contains('btn-delete-espec')) {
            
            const itemParaRemover = e.target.closest('.espec-item');
            if (itemParaRemover) {
                itemParaRemover.remove();
            }
        }
    });

});
</script>
</body>
</html>