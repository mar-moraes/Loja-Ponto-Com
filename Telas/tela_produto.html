<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Página do Produto</title>

  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="estilo_carrinho.css">
  <link rel="stylesheet" href="estilo_produto.css">

</head>

<body>
    <header class="topbar">
      <nav class="actions" style="display: flex; justify-content: space-between; align-items: center; padding: 20px 40px;">
        <div style="display: flex; align-items: center; justify-content: flex-start; flex: 1;">
          <a href="index.html" style="display: flex; align-items: center;">
            <img src="imagens/exemplo-logo.png" alt="" style="width: 40px; height: 40px; margin-right: 20px; margin-left: 0;">
          </a>
        </div>
        <form action="buscar.php" method="GET" style="display: flex; align-items: center; width: 500px; max-width: 100%;">
          <input type="search" id="pesquisa" name="q" placeholder="Digite sua busca..." style="font-size: 16px; width: 300px; height: 40px;">
          <button type="submit" style="margin-left: 0px; height: 40px;">
            <img src="imagens/lupa.png" alt="lupa" style="width: 28px; height: 28px;">
          </button>
        </form>
        <div style="display: flex; gap: 30px; align-items: center;">
          <a href="#">Crie a sua conta</a>
          <a href="#">Entre</a>
          <a href="tela_carrinho.html" style="display: flex; align-items: center; gap: 5px;">
            Carrinho
            <img src="imagens/carrinho invertido.png" alt="" style="width: 20px; height: 20px;">
          </a>
        </div>
      </nav>
    </header>

      <main class="produto-container" 
          data-title="" 
          data-price="" 
          data-img="">
      
      <div class="coluna-galeria">
        <div class="thumbnails">
          <img src="" alt="Thumb 1" class="thumb-img active" onmouseover="mudarImagem(this)">
          <img src="imagens/Zane lego - 1.jpg" alt="Thumb 2" class="thumb-img" onmouseover="mudarImagem(this)">
          <img src="imagens/Zane lego - 2.jpg" alt="Thumb 3" class="thumb-img" onmouseover="mudarImagem(this)">
        </div>
        <div class="imagem-principal-container">
          <img src="" alt="Imagem Principal do Produto" id="imagem-principal">
        </div>
      </div>

      <div class="coluna-info">
        
        <button class="btn-favoritar" id="btn-favoritar">
          <svg width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
        </button>

        <h1 class="produto-titulo" id="produto-titulo">Carregando...</h1>
        
        <div class="produto-preco">?
          <span class="old" id="produto-preco-antigo"></span>
          <span class="price" id="produto-preco"></span>
          <span class="badge" id="produto-badge"></span>
        </div>

        <div class="especificacoes-rapidas">

          <div class="produto-avaliacao">
            <span class="star" data-value="1">&#9734;</span>
            <span class="star" data-value="2">&#9734;</span>
            <span class="star" data-value="3">&#9734;</span>
            <span class="star" data-value="4">&#9734;</span>
            <span class="star" data-value="5">&#9734;</span>
          </div>          

          <h3>O que você precisa saber sobre este produto:</h3>
          <ul>
            <li>Compatível com outros conjuntos LEGO.</li>
            <li>Inclui 3 minifiguras.</li>
            <li>Recomendado para maiores de 8 anos.</li>
            <li>Material: Plástico ABS.</li>
          </ul>
        </div>

        <label class="label-quantidade">Quantidade:</label>
        <div class="seletor-quantidade-wrapper">
            <div class="contador-container" style="margin-right: 0; justify-content: flex-start;">
              <button type="button" onclick="alterarContador(-1)">-</button>
              <div id="contador-numero" class="contador-numero" style="color: black; font-weight:500;">1</div>
              <button type="button" onclick="alterarContador(1)">+</button>
            </div>
            <span class="qtd-disponivel">(2 disponíveis)</span>
        </div>

        <div class="botoes-acao">
          <button class="btn-acao btn-comprar" id="btn-comprar">Comprar agora</button>
          <button class="btn-acao btn-adicionar" id="btn-adicionar-carrinho">Adicionar ao carrinho</button>
        </div>
      </div>
</main>
    <div class="detalhes-produto-container">

      <section id="caracteristicas" class="detalhe-bloco">
        <h2>Características principais</h2>
        
        <div class="caracteristicas-tabela">
          <div class="caracteristica-item">
            <span>Marca</span>
            <span>LEGO</span>
          </div>
          <div class="caracteristica-item">
            <span>Linha</span>
            <span>NINJAGO</span>
          </div>
          <div class="caracteristica-item">
            <span>Modelo</span>
            <span>71741</span>
          </div>
          <div class="caracteristica-item">
            <span>Tipo de alimentação</span>
            <span>N/A</span>
          </div>
          <div class="caracteristica-item">
            <span>Cor</span>
            <span>Colorido</span>
          </div>
        </div>
      </section>

      <section id="descricao" class="detalhe-bloco">
        <h2>Descrição do produto</h2>
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam in dui mauris. 
          Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu 
          tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim. Phasellus 
          molestie magna non est bibendum non venenatis nisl tempor. Suspendisse 
          dictum feugiat nisl ut dapibus.
        </p>
        <p>
          Maecenas porta, nisl et consequat vestibulum, ex nulla laoreet odio, 
          nec tempor justo urna in neque. Cras id nisl nec erat ultrices 
          condimentum.
        </p>
      </section>

      <section id="opinioes" class="detalhe-bloco">
        <h2>Opiniões do produto</h2>
        
        <div class="opiniao-form">
          <textarea placeholder="Escreva sua opinião aqui... (Esta é uma demonstração visual, o botão não salva os dados)"></textarea>
          <button type="button" class="btn-acao btn-comprar">Enviar</button>
        </div>
      </section>

    </div>
  <script>
  // --- 0. PREENCHIMENTO DA PÁGINA (NOVO BLOCO) ---
  // ... (o restante do seu script javascript) ...

  // --- 0. PREENCHIMENTO DA PÁGINA (NOVO BLOCO) ---
  // Este script roda assim que a página termina de carregar
  
  document.addEventListener("DOMContentLoaded", () => {
    // 1. Tenta ler o produto do localStorage
    const produto = JSON.parse(localStorage.getItem("produtoSelecionado"));

    // 2. Verifica se o produto existe
    if (produto) {
      // 3. Seleciona os elementos da página que vamos preencher
      const container = document.querySelector(".produto-container");
      const imagemPrincipal = document.getElementById("imagem-principal");
      const thumbImg = document.querySelector(".thumb-img"); // Pega a primeira
      const titulo = document.getElementById("produto-titulo");
      const preco = document.getElementById("produto-preco");
      const precoAntigo = document.getElementById("produto-preco-antigo");
      const badge = document.getElementById("produto-badge");

      // 4. Preenche os data-attributes do container
      // (Isso é crucial para os botões 'Comprar' e 'Favoritar' funcionarem)
      container.dataset.title = produto.title;
      container.dataset.price = produto.priceValue;
      container.dataset.img = produto.img;
      
      // 5. Preenche os elementos visuais na página
      titulo.innerText = produto.title;
      preco.innerText = produto.price;
      precoAntigo.innerText = produto.oldPrice;
      badge.innerText = produto.badge;
      
      // 6. Preenche as imagens
      imagemPrincipal.src = produto.img;
      thumbImg.src = produto.img;

      // 7. Verifica se o item já está favoritado (nos 'salvos')
      const btnFavoritar = document.getElementById("btn-favoritar");
      const salvos = JSON.parse(localStorage.getItem("salvos")) || []; // Pega a lista de salvos
      
      // Compara pelo título (que é o identificador único até agora)
      const existenteEmSalvos = salvos.find(p => p.title === produto.title); 

      if (existenteEmSalvos) {
        // Se estiver, já marca o botão como ativo
        btnFavoritar.classList.add("active");
      }
      
      // =======================================================
      // --- INÍCIO DA CORREÇÃO (BLOCO MOVIDO E CORRIGIDO) ---
      // 8. Carrega a avaliação (estrelas) salva
      // As vars 'currentRating' e 'drawStars' são definidas mais abaixo,
      // mas são acessíveis globalmente no script.
      // =======================================================
      const savedRating = localStorage.getItem("rating_" + container.dataset.title);
      if (savedRating) {
        currentRating = parseInt(savedRating); // Atualiza a variável global
        drawStars(currentRating); // Desenha as estrelas salvas
      }
      // --- FIM DA CORREÇÃO ---


      // 9. Opcional: Limpar o item do localStorage...
      // localStorage.removeItem("produtoSelecionado");

    } else {
      // 10. Se, por algum motivo, o usuário chegar aqui sem um produto,
      // podemos redirecioná-lo de volta para a home.
      alert("Nenhum produto foi selecionado. Voltando para a loja.");
      window.location.href = "index.html";
    }
  });


  // --- 1. SELETORES DOS ELEMENTOS (Resto do script) ---
  const container = document.querySelector(".produto-container");
  const imagemPrincipal = document.getElementById("imagem-principal");
  const thumbnails = document.querySelectorAll(".thumb-img");
  
  const contadorNumero = document.getElementById("contador-numero");
  

  let quantidade = 1;

  const btnComprar = document.getElementById("btn-comprar");
  const btnAdicionar = document.getElementById("btn-adicionar-carrinho");
  const btnFavoritar = document.getElementById("btn-favoritar");

  // --- 2. LÓGICA DA GALERIA ---
  function mudarImagem(thumbElement) {
    // Define a imagem principal
    imagemPrincipal.src = thumbElement.src;
    
    // Remove a classe 'active' de todas as thumbnails
    thumbnails.forEach(thumb => thumb.classList.remove("active"));
    
    // Adiciona a classe 'active' apenas na clicada
    thumbElement.classList.add("active");
  }

  // --- 3. LÓGICA DO CONTADOR DE QUANTIDADE ---
  function alterarContador(valor) {
    quantidade += valor;
    if (quantidade < 1) {
      quantidade = 1; // Não permite quantidade menor que 1
    }
    // (Opcional) Adicionar verificação de estoque máximo (ex: 2)
    // if (quantidade > 2) quantidade = 2;
    
    contadorNumero.innerText = quantidade;
  }

  // --- 4. FUNÇÃO AUXILIAR PARA PEGAR DADOS DO PRODUTO ---
  // Esta função agora lê os dados que o script (item 0) preencheu
  function getDadosProduto() {
    return {
      title: container.dataset.title,
      price: parseFloat(container.dataset.price),
      img: container.dataset.img,
      quantidade: quantidade // Pega a quantidade do contador
    };
  }

  // --- 5. LÓGICA DAS AÇÕES (CARRINHO E FAVORITOS) ---
  // (Esta parte permanece a mesma da resposta anterior)

  // Botão "Adicionar ao carrinho"
  btnAdicionar.addEventListener("click", () => {
    const produto = getDadosProduto();
    let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];

    // Verifica se o produto já existe
    const existente = carrinho.find(p => p.title === produto.title);

    if (existente) {
      existente.quantidade += produto.quantidade;
    } else {
      carrinho.push(produto);
    }

    localStorage.setItem("carrinho", JSON.stringify(carrinho));

    // Redireciona imediatamente para o carrinho
    window.location.href = "tela_carrinho.html"; // <-- Linha alterada
  });

  // Botão "Comprar agora" (Verifica login, Adiciona e Redireciona)
  btnComprar.addEventListener("click", () => {
    
    // 1. Verifica se o usuário está logado (lógica do tela_carrinho.html)
    const usuarioLogado = localStorage.getItem("usuarioLogado");

    if (!usuarioLogado) {
      // 2. Se NÃO estiver logado, redireciona para login
      alert("Você precisa estar logado para continuar. Redirecionando...");
      window.location.href = "tela_login.html";
    
    } else {
      // 3. Se ESTIVER logado, executa a ação original
      const produto = getDadosProduto();
      let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
      
      const existente = carrinho.find(p => p.title === produto.title);

      if (existente) {
        existente.quantidade += produto.quantidade;
      } else {
        carrinho.push(produto);
      }

      localStorage.setItem("carrinho", JSON.stringify(carrinho));
      
      // Redireciona imediatamente para o carrinho
      window.location.href = "tela_carrinho.html";
    }
  });

  // Botão "Favoritar" (Alterna Salvar/Remover)
  btnFavoritar.addEventListener("click", (e) => {
    const produto = getDadosProduto();
    // Define a quantidade padrão para favoritos
    produto.quantidade = 1; 
    
    let salvos = JSON.parse(localStorage.getItem("salvos")) || [];

    // Procura o ÍNDICE do produto na lista de salvos
    const indexExistente = salvos.findIndex(p => p.title === produto.title);

    if (indexExistente === -1) {
      // --- SE NÃO EXISTE: ADICIONA (FAVORITA) ---
      salvos.push(produto);
      
      // Altera o visual do botão
      btnFavoritar.classList.add("active");
      
    } else {
      // --- SE JÁ EXISTE: REMOVE (DESFAVORITA) ---
      salvos.splice(indexExistente, 1); // Remove o item pelo índice
      
      // Altera o visual do botão
      btnFavoritar.classList.remove("active");
    }
    
    // Salva o array atualizado (adicionado ou removido) no localStorage
    localStorage.setItem("salvos", JSON.stringify(salvos));
  });

  // --- 6. LÓGICA DE AVALIAÇÃO (ESTRELAS) ---
  const stars = document.querySelectorAll(".produto-avaliacao .star");
  const starContainer = document.querySelector(".produto-avaliacao");
  
  // Variável para guardar a nota que foi clicada
  let currentRating = 0; 

  // =======================================================
  // --- CORREÇÃO: O Bloco que estava aqui foi REMOVIDO ---
  // (O 'if (savedRating) ...' estava quebrado e no
  // lugar errado. Ele foi movido para a Seção 0)
  // =======================================================

  /**
   * Função para desenhar as estrelas
   * @param {number} rating - A nota (1 a 5) a ser exibida
   */
  function drawStars(rating) {
    stars.forEach(star => {
      const starValue = parseInt(star.dataset.value);
      
      if (starValue <= rating) {
        star.classList.add("filled");
        star.innerHTML = "&#9733;"; // Ícone de estrela cheia
      } else {
        star.classList.remove("filled");
        star.innerHTML = "&#9734;"; // Ícone de estrela vazia
      }
    });
  }

  // Adiciona eventos de HOVER (mouse enter) para cada estrela
  stars.forEach(star => {
    star.addEventListener("mouseover", () => {
      const rating = parseInt(star.dataset.value);
      drawStars(rating); // Preenche as estrelas até a que está em hover
    });

    // Adiciona evento de CLIQUE para cada estrela
    star.addEventListener("click", () => {
      currentRating = parseInt(star.dataset.value); // Salva a nota
      
      // Salva a nota no localStorage
      localStorage.setItem("rating_" + container.dataset.title, currentRating);
      
      drawStars(currentRating); // Trava a nota clicada
    });
  });

  // Adiciona evento de MOUSE LEAVE (mouse out) no CONTAINER
  starContainer.addEventListener("mouseleave", () => {
    // Quando o mouse sai, volta para a nota que foi CLICADA (currentRating)
    drawStars(currentRating);
  });

</script>
</body>
</html>
