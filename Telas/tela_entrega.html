<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forma de Entrega</title>
  <link rel="stylesheet" href="estilo_entrega.css">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <header class="topbar-entrega">
      <nav class="actions-entrega">
        <div class="logo-container">
          <a href="index.html">
            <img src="imagens/exemplo-logo.png" alt="Logo" class="logo">
          </a>
        </div>
        <div class="user-menu">
          <a href="#">
            <i class="fa-regular fa-user"></i>
            Usuarío
            <i class="fa-solid fa-chevron-down"></i>
          </a>
          <a href="#">Contato</a>
        </div>
      </nav>
    </header>

    <main class="entrega-layout-container">
        
        <div class="opcoes-entrega">
            <h2>Escolha a forma de entrega</h2>
            
            <form id="form-entrega">
                <div class="opcao-bloco selecionado">
                    <input type="radio" id="enviar-endereco" name="forma-entrega" value="endereco" checked>
                    <label for="enviar-endereco" class="opcao-label">
                        <div class="opcao-titulo">
                            <span>Enviar no meu endereço</span>
                            <span class="preco-gratis">Grátis</span>
                        </div>
                        <div class="opcao-detalhes">
                            <p>Rua Exemplo Fictício, 123 - Jd. Amanda</p>
                            <p>CEP 13180-000 - Hortolândia, São Paulo</p>
                            <p class="tipo-endereco">Residencial</p>
                            <a href="#" class="link-acao" onclick="mostrarModal('modal-editar-endereco')">Alterar ou escolher outro endereço</a>
                        </div>
                    </label>
                </div>

                <div class="opcao-bloco">
                    <input type="radio" id="retirar-agencia" name="forma-entrega" value="agencia">
                    <label for="retirar-agencia" class="opcao-label">
                        <div class="opcao-titulo">
                            <span>Retirada na Agência</span>
                            <span class="preco">R$ 7,99</span>
                        </div>
                        <div class="opcao-detalhes">
                            <p class="distancia">A 450 m do seu endereço</p>
                            <p>Agência - LOJA 1 - (Centro)</p>
                            <p>Segunda à sexta das 9 às 17:30 hs. - Sábado das 9 às 15 hs.</p>
                            <a href="#" class="link-acao" onclick="mostrarModal('modal-retirar-agencia')">Ver agência no mapa ou selecionar outra</a>
                        </div>
                    </label>
                </div>
                
                <button type="button" class="btn-continuar-entrega">Continuar</button>
            </form>
        </div>

        <aside class="resumo-compra">
            <h3>Resumo da compra</h3>
            <div class="resumo-linha">
                <span>Produto</span>
                <span id="resumo-produto-preco">R$ 0,00</span>
            </div>
            <div class="resumo-linha">
                <span>Frete</span>
                <span id="resumo-frete-preco" class="preco-gratis">GRÁTIS</span>
            </div>
            <div class="resumo-divisor" style="display: block;"></div>
            <div class="resumo-linha total">
                <span>Total</span>
                <span id="resumo-total-preco">R$ 0,00</span>
            </div>
        </aside>

    </main>

    <div class="modal-overlay" id="modal-editar-endereco" onclick="fecharModal('modal-editar-endereco')">
        <div class="modal-conteudo" onclick="event.stopPropagation()">
            <button class="modal-fechar" onclick="fecharModal('modal-editar-endereco')"><i class="fa-solid fa-xmark"></i></button>
            <h3>Editar endereço</h3>
            
            <form class="form-modal">
                <div class="form-grupo">
                    <label for="cep">CEP</label>
                    <input type="text" id="cep" placeholder="Ex.: 13184-000">
                    <a href="#" class="link-form">Não sei meu CEP</a>
                </div>
                
                <div class="form-linha">
                    <div class="form-grupo" style="flex: 2;">
                        <label for="rua">Rua / Avenida</label>
                        <input type="text" id="rua" placeholder="Ex.: Avenida Los Leones, 4563">
                    </div>
                    <div class="form-grupo" style="flex: 1;">
                        <label for="numero">Número</label>
                        <input type="text" id="numero" placeholder="Ex.: 45607052">
                        <div class="checkbox-container">
                            <input type="checkbox" id="sem-numero">
                            <label for="sem-numero">Sem número</label>
                        </div>
                    </div>
                </div>

                <div class="form-grupo">
                    <label for="complemento">Complemento (opcional)</label>
                    <input type="text" id="complemento" placeholder="Ex.: 201">
                </div>

                <div class="form-grupo">
                    <label for="info-adicional">Informações adicionais deste endereço (opcional)</label>
                    <textarea id="info-adicional" placeholder="Ex.: Entre ruas, cor do edifício, não tem campainha." maxlength="128"></textarea>
                    <span class="char-contador">0 / 128</span>
                </div>

                <div class="form-grupo">
                    <p>Este é o seu trabalho ou sua casa?</p>
                    <div class="radio-grupo">
                        <input type="radio" id="casa" name="tipo-local" checked>
                        <label for="casa"><i class="fa-solid fa-house"></i> Casa</label>
                    </div>
                    <div class="radio-grupo">
                        <input type="radio" id="trabalho" name="tipo-local">
                        <label for="trabalho"><i class="fa-solid fa-briefcase"></i> Trabalho</label>
                    </div>
                </div>

                <div class="form-grupo">
                    <p>Dados de contato</p>
                    <span>Se houver algum problema no envio, você receberá uma ligação neste número.</span>
                    <label for="nome" style="margin-top: 10px;">Nome e sobrenome</label>
                    <input type="text" id="nome" class="input-erro">
                    <span class="msg-erro">Você deve inserir nome e sobrenome.</span>
                </div>
                
            </form>
        </div>
    </div>
    <div class="modal-overlay" id="modal-retirar-agencia" onclick="fecharModal('modal-retirar-agencia')">
        <div class="modal-conteudo modal-grande" onclick="event.stopPropagation()">
            <button class="modal-fechar" onclick="fecharModal('modal-retirar-agencia')"><i class="fa-solid fa-xmark"></i></button>
            <h3>Selecione um ponto de retirada</h3>
            <span class="subtitulo-modal">A agência deve estar localizada no mesmo estado do seu endereço de faturamento.</span>

            <div class="form-grupo" style="margin-top: 15px;">
                <input type="search" id="busca-local" placeholder="Busque uma localização">
            </div>

            <div class="retirada-layout">
                <div class="lista-agencias">
                    <span class="resultado-busca">Mostrando 15 resultados</span>
                    <div class="agencia-item">
                        <h4>LOJA 1</h4>
                        <p>Agência</p>
                        <p><i class="fa-solid fa-location-dot"></i> RUA LUIZ CAMILO DE CAMARGO, 581, Centro, Hortolândia (13184-230) - a 0 m</p>
                        <p><i class="fa-regular fa-clock"></i> Segunda à sexta das 9 às 17:30 hs. - Sábado das 9 às 15 hs.</p>
                        <div class="agencia-footer">
                            <span>Chegará na agência quarta-feira <strong>R$ 5,99</strong></span>
                            <button class="btn-escolher">Escolher</button>
                        </div>
                    </div>
                    <div class="agencia-item">
                        <h4>PONTO EXTRA HORTOLÂNDIA</h4>
                        <p>Agência</p>
                        <p><i class="fa-solid fa-location-dot"></i> AV. DA EMACIPAÇÃO, 1200, Jardim Santa Rita de Cássia, Hortolândia (13186-505) - a 1,2 km</p>
                        <p><i class="fa-regular fa-clock"></i> Segunda à sábado das 8 às 18:30 hs. - Segunda à sábado das 14:30 às 18 hs. - Domingo das 8 às 12 hs.</p>
                        <div class="agencia-footer">
                            <span>Chegará na agência quarta-feira <strong>R$ 5,99</strong></span>
                            <button class="btn-escolher">Escolher</button>
                        </div>
                    </div>
                </div>
                <div class="mapa-container">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d14704.512437314232!2d-47.19298736839293!3d-22.871725497468567!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sbr!4v1760985459396!5m2!1sen!2sbr" 
                        width="100%" 
                        height="100%" 
                        style="border:0;" 
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- Variável global para guardar o subtotal vindo do carrinho ---
        let subtotalCompra = 0.0;

        // --- Funções para controlar os Modais (Subtelas) ---
        function mostrarModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- NOVA FUNÇÃO: Atualiza o Resumo da Compra ---
        function atualizarResumoEntrega() {
            // Verifica qual opção de entrega está selecionada
            const freteSelecionado = document.querySelector('input[name="forma-entrega"]:checked').value;
            const freteSpan = document.getElementById("resumo-frete-preco");

            let valorFrete = 0.0;
            let textoFrete = "GRÁTIS";
            
            // Define o valor do frete baseado na seleção
            if (freteSelecionado === 'agencia') {
                valorFrete = 7.99; // Valor da agência (de Hortolândia)
                textoFrete = "R$ 7,99";
                freteSpan.classList.remove("preco-gratis");
            } else {
                valorFrete = 0.0; // Valor do endereço (Grátis)
                textoFrete = "GRÁTIS";
                freteSpan.classList.add("preco-gratis");
            }

            // Calcula o total final
            const valorTotal = subtotalCompra + valorFrete;

            // Atualiza os valores no HTML
            document.getElementById("resumo-produto-preco").innerText = "R$ " + subtotalCompra.toFixed(2).replace(".", ",");
            freteSpan.innerText = textoFrete;
            document.getElementById("resumo-total-preco").innerText = "R$ " + valorTotal.toFixed(2).replace(".", ",");
        }


        // --- Lógica para selecionar as opções de entrega (MODIFICADA) ---
        document.querySelectorAll('input[name="forma-entrega"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // Remove a classe 'selecionado' de todos
                document.querySelectorAll('.opcao-bloco').forEach(bloco => {
                    bloco.classList.remove('selecionado');
                });

                // Adiciona a classe 'selecionado' apenas ao 'pai' do radio checado
                if (this.checked) {
                    this.closest('.opcao-bloco').classList.add('selecionado');
                }

                // ATUALIZA O RESUMO QUANDO A OPÇÃO MUDA
                atualizarResumoEntrega();
            });
        });

        // --- NOVO: Roda quando a página carrega ---
        document.addEventListener("DOMContentLoaded", () => {
            // 1. Pega o valor total salvo no localStorage
            const totalSalvo = localStorage.getItem("totalCompra");
            
            // 2. Se existir, atualiza a variável global 'subtotalCompra'
            if (totalSalvo) {
                subtotalCompra = parseFloat(totalSalvo);
            }
            
            // 3. Roda a função de atualização para mostrar os valores corretos
            // (Isso vai usar o subtotal salvo e o frete padrão que está 'checked')
            atualizarResumoEntrega();
        });

    </script>
</body>
</html>