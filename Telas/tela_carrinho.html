<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Tela de Compras</title>

  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="estilo_carrinho.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

  <style>
    /* ... (seu style inline permanece o mesmo) ... */
    .carrinho-tabs {
      display: flex;
      gap: 10px;
      border-bottom: 1px solid #ddd;
    }
    .carrinho-tab {
      font-size: 16px;
      font-weight: 500;
      color: #666;
      background: none;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    .carrinho-tab.active {
      color: #2968C8; 
      border-bottom: 3px solid #2968C8;
    }
  </style>

</head>

<body>
    <header class="topbar">
      <nav class="actions" style="display: flex; justify-content: space-between; align-items: center; padding: 20px 40px;">
        <div style="display: flex; align-items: center; justify-content: flex-start; flex: 1;">
          <a href="index.html" style="display: flex; align-items: center;">
            <img src="imagens/exemplo-logo.png" alt="" style="width: 40px; height: 40px; margin-right: 20px; margin-left: 0;">
          </a>
        </div>
        <form action="buscar.php" method="GET" style="display: flex; align-items: center; width: 500px; max-width: 100%;">
          <input type="search" id="pesquisa" name="q" placeholder="Digite sua busca..." style="font-size: 16px; width: 300px; height: 40px;">
          <button type="submit" style="margin-left: 0px; height: 40px;">
            <img src="imagens/lupa.png" alt="lupa" style="width: 28px; height: 28px;">
          </button>
        </form>
        <div style="display: flex; gap: 30px; align-items: center;">
          <a href="#">Crie a sua conta</a>
          <a href="#">Entre</a>
          <a href="tela_carrinho.html" style="display: flex; align-items: center; gap: 5px;">
            Carrinho
            <img src="imagens/carrinho invertido.png" alt="" style="width: 20px; height: 20px;">
          </a>
        </div>
      </nav>
    </header>

    <div class="carrinho-layout-container">
    
      <div style="flex: 1; min-width: 400px;">
    
        <div class="carrinho-tabs">
          <button id="tab-carrinho" class="carrinho-tab active">Carrinho (0)</button>
          <button id="tab-salvos" class="carrinho-tab">Salvos (0)</button>
        </div>
    
        <div class="painel" id="painel-carrinho" style="margin-top: 20px;">
          </div>
        
        <div class="painel" id="painel-salvos" style="display: none; margin-top: 20px;">
          </div>
        
      </div> 
      
      <div class="resumo-container">
        <h3 class="resumo-titulo-fixo">Resumo da compra</h3>
        <div id="resumo-separador"></div>
        <div id="total-container">
            <span>Total:</span>
            <span id="valor-total">R$ 0,00</span>
        </div>
        <button type="button" class="btn-continuar">Continuar a compra</button>
      </div>
    
    </div>

    <div class="carrinho-layout-container">
    </div>
  <div class="recomendacoes-container">
    <h2>Produtos que podem interessar</h2>
    
<div class="swiper recomendacoes-swiper">
      <div class="swiper-wrapper">
        
        <div class="swiper-slide">
          <a href="tela_produto.html" class="card-link">
            <article class="card" data-price="159.79">
              <div class="thumb" style="background-image:url('imagens/Zane lego.jpg')"></div>
              <div class="title">LEGO NINJAGO!!</div>
              <div class="card-avaliacao"></div> <div>
                <span class="old">R$ 199,99</span>
                <span class="price">R$ 159,79</span>
                <span class="badge">21% OFF</span>
              </div>
            </article>
          </a>
        </div>

        <div class="swiper-slide">
          <article class="card" data-price="">
            <div class="thumb" style="background-image:url('')"></div>
            <div class="title"></div>
            <div class="card-avaliacao"></div>
            <div>
              <span class="old"></span>
              <span class="price"></span>
              <span class="badge"></span>
              <span class="parcel"></span>
              <div><di/v>
            </div>
          </article>
        </div>
        
        <div class="swiper-slide">
          <article class="card" data-price="">
            <div class="thumb" style="background-image:url('')"></div>
            <div class="title"></div>
            <div class="card-avaliacao"></div>
            <div>
              <span class="old"></span>
              <span class="price"></span>
              <span class="badge"></span>
              <span class="parcel"></span>
              <div><di/v>
            </div>
          </article>
        </div>

        <div class="swiper-slide">
          <article class="card" data-price="">
            <div class="thumb" style="background-image:url('')"></div>
            <div class="title"></div>
            <div class="card-avaliacao"></div>
            <div>
              <span class="old"></span>
              <span class="price"></span>
              <span class="badge"></span>
              <span class="parcel"></span>
              <div><di/v>
            </div>
          </article>
        </div>

        <div class="swiper-slide">
          <article class="card" data-price="">
            <div class="thumb" style="background-image:url('')"></div>
            <div class="title"></div>
            <div class="card-avaliacao"></div>
            <div>
              <span class="old"></span>
              <span class="price"></span>
              <span class="badge"></span>
              <span class="parcel"></span>
              <div><di/v>
            </div>
          </article>
        </div>

      </div> <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>

<script>
  // --- 1. RECUPERAÇÃO DE DADOS E SELETORES ---
  let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
  let salvos = JSON.parse(localStorage.getItem("salvos")) || []; 

  const painelCarrinho = document.getElementById("painel-carrinho");
  const painelSalvos = document.getElementById("painel-salvos"); 

  const tabCarrinho = document.getElementById("tab-carrinho"); 
  const tabSalvos = document.getElementById("tab-salvos"); 
  
  const resumoContainer = document.querySelector(".resumo-container"); 
  const totalSpan = document.getElementById("valor-total");
  const separador = document.getElementById("resumo-separador");
  const totalContainer = document.getElementById("total-container");
  const btnContinuar = document.querySelector(".btn-continuar");

  // --- 2. FUNÇÕES DE RENDERIZAÇÃO ---
  // ... (funções renderCarrinho() e renderSalvos() permanecem as mesmas) ...
  // Renderiza os itens do CARRINHO (CORRIGIDA)
  function renderCarrinho() {
    if (carrinho.length === 0) {
      painelCarrinho.innerHTML = "<p style=\"display: flex; align-items: center; justify-content: left;\"><img src=\"imagens/carrinho.png\" alt=\"\" style=\"width: 30px; height: 30px; margin-right: 5px;\"> Nenhum produto no carrinho. </p>";    
      
      // Reseta os estilos que o 'else' aplica
      painelCarrinho.style.flexDirection = "initial"; 
      painelCarrinho.style.gap = "0";
    } else {
      // Adiciona 'gap' para espaçar os produtos
      painelCarrinho.style.display = "flex"; // Garante que é flex
      painelCarrinho.style.flexDirection = "column";
      painelCarrinho.style.gap = "15px";

      painelCarrinho.innerHTML = carrinho.map((produto, index) => {
        const imgSrc = typeof produto.img === "string" ? produto.img.replace('url("', '').replace('")', '') : "";
        const quantidade = typeof produto.quantidade === "number" ? produto.quantidade : 1;
        const price = typeof produto.price === "number" ? produto.price : 0;
        return `
            <div class="produto" style="display: flex; align-items: center; gap: 10px; border-radius: 8px; border: 1px solid #e0e0e0; padding: 10px;">
              <img src="${imgSrc}" alt="Produto" style="width:80px; height:80px; object-fit:cover;">
              <div style="display: flex; flex-direction: column; gap: 6px; flex: 1;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <p style="margin: 0;">${produto.title || ""}</p>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="contador-container">
                      <button type="button" onclick="alterarContador(${index}, -1)">-</button>
                      <div id="contador${index}" class="contador-numero" style="color: black; font-weight:500; ">${quantidade}</div>
                      <button type="button" onclick="alterarContador(${index}, 1)">+</button>
                    </div>
                    <span id="preco${index}" style="color: black; white-space: nowrap; margin-right: 10px;">R$ ${(price * quantidade).toFixed(2)}</span>
                  </div>
                </div>
                <div style="display: flex; align-items: center; gap: 15px; margin-top: 4px;">
                  <button type="button" onclick="comprarAgora(${index})" style="color: blue; background: none; border: none; padding: 0; cursor: pointer; font-size: 12px;">Comprar agora</button>
                  <button type="button" onclick="salvarDepois(${index})" style="color: blue; background: none; border: none; border-left: 1px solid rgba(0,0,0,0.15); border-right: 1px solid rgba(0,0,0,0.15); padding: 0 8px; cursor: pointer; font-size: 12px; outline: none;">Salvar para depois</button>
                  <button type="button" onclick="removerProduto(${index})" style="color: blue; background: none; border: none; padding: 0; cursor: pointer; font-size: 12px;">Excluir</button>
                </div>
              </div>
            </div>
        `;
      }).join("");
    }
  }

  // Renderiza os itens SALVOS (CORRIGIDA)
  function renderSalvos() {
    if (salvos.length === 0) {
      painelSalvos.innerHTML = "<p>Nenhum item salvo para depois.</p>";

      // Reseta os estilos que o 'else' aplica
      painelSalvos.style.flexDirection = "initial";
      painelSalvos.style.gap = "0";
    } else {
      // Adiciona 'gap' para espaçar os produtos
      painelSalvos.style.display = "flex"; // Garante que é flex
      painelSalvos.style.flexDirection = "column";
      painelSalvos.style.gap = "15px";

      painelSalvos.innerHTML = salvos.map((produto, index) => {
        const imgSrc = typeof produto.img === "string" ? produto.img.replace('url("', '').replace('")', '') : "";
        const price = typeof produto.price === "number" ? produto.price : 0;
        return `
          <div class="produto" style="display: flex; align-items: center; gap: 10px; border-radius: 8px; border: 1px solid #e0e0e0; padding: 10px;">
            <img src="${imgSrc}" alt="Produto" style="width:80px; height:80px; object-fit:cover;">
            <div style="display: flex; flex-direction: column; gap: 6px; flex: 1;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <p style="margin: 0;">${produto.title || ""}</p>
                <span style="color: black; white-space: nowrap; margin-right: 10px;">R$ ${price.toFixed(2)}</span>
              </div>
              <div style="display: flex; align-items: center; gap: 15px; margin-top: 4px;">
                <button type="button" onclick="moverParaCarrinho(${index})" style="color: blue; background: none; border: none; padding: 0; cursor: pointer; font-size: 12px;">Mover para o carrinho</button>
                <button type="button" onclick="removerDosSalvos(${index})" style="color: blue; background: none; border: none; padding: 0 8px; border-left: 1px solid rgba(0,0,0,0.15); cursor: pointer; font-size: 12px;">Excluir</button>
              </div>
            </div>
          </div>
        `;
      }).join("");
    }
  }


  // --- 3. FUNÇÕES DE ATUALIZAÇÃO (Total e Contadores) ---
  // ... (funções atualizarTotal() e atualizarContadoresTabs() permanecem as mesmas) ...
  // Atualiza o TOTAL (bloco de resumo)
  function atualizarTotal() {
    if (carrinho.length === 0) {
      separador.style.display = "none";
      totalContainer.style.display = "none";
      btnContinuar.style.display = "none";
    } else {
      const total = carrinho.reduce((acc, p) => acc + (p.price * p.quantidade), 0);
      separador.style.display = "block";
      totalContainer.style.display = "flex";
      btnContinuar.style.display = "block"; 
      totalSpan.innerText = "R$ " + total.toFixed(2).replace(".", ",");
    }
  }

  // Atualiza os contadores nas ABAS
  function atualizarContadoresTabs() {
    tabCarrinho.innerText = `Carrinho (${carrinho.length})`;
    tabSalvos.innerText = `Salvos (${salvos.length})`;
  }

  // --- 4. FUNÇÕES DE AÇÃO DOS PRODUTOS ---
  // ... (funções alterarContador(), removerProduto(), removerDosSalvos(), comprarAgora(), salvarDepois(), moverParaCarrinho() permanecem as mesmas) ...
  function alterarContador(index, valor) {
    const item = carrinho[index];
    item.quantidade += valor;
    if (item.quantidade < 1) item.quantidade = 1;

    localStorage.setItem("carrinho", JSON.stringify(carrinho));

    document.getElementById(`contador${index}`).textContent = item.quantidade;
    document.getElementById(`preco${index}`).textContent = "R$ " + (item.price * item.quantidade).toFixed(2);

    atualizarTotal();
  }

  // Remove do Carrinho (ATUALIZADA)
  function removerProduto(index) {
    carrinho.splice(index, 1);
    localStorage.setItem("carrinho", JSON.stringify(carrinho));
    
    renderCarrinho(); // Atualiza o conteúdo
    atualizarContadoresTabs(); // Atualiza a aba
    mostrarCarrinho(); // Garante que a visão (painel + resumo) está correta
  }

  // Remove dos Salvos (ATUALIZADA)
  function removerDosSalvos(index) {
    salvos.splice(index, 1);
    localStorage.setItem("salvos", JSON.stringify(salvos));
    
    renderSalvos(); // Atualiza o conteúdo
    atualizarContadoresTabs(); // Atualiza a aba
    mostrarSalvos(); // Garante que a visão (painel) está correta
  }

  function comprarAgora(index) {
    // 1. Pega o produto específico do carrinho
    const produto = carrinho[index];
    
    // 2. Calcula o total APENAS para este item (preço * quantidade)
    const totalDoProduto = produto.price * produto.quantidade;
    
    // 3. Salva esse total no localStorage (mesma chave que a tela_entrega usa)
    localStorage.setItem("totalCompra", totalDoProduto.toFixed(2));
    
    // 4. Redireciona para a tela de entrega
    window.location.href = "tela_entrega.html";
  }

  // "Salvar para depois" (ATUALIZADA)
  function salvarDepois(index) {
    const item = carrinho[index];
    
    salvos.push(item);
    carrinho.splice(index, 1);
    
    localStorage.setItem("carrinho", JSON.stringify(carrinho));
    localStorage.setItem("salvos", JSON.stringify(salvos));
    
    renderCarrinho();
    renderSalvos();
    atualizarContadoresTabs();
    mostrarCarrinho(); // Garante que a visão (painel + resumo) é atualizada
  }

  // Mover dos Salvos para o Carrinho (ATUALIZADA)
  function moverParaCarrinho(index) {
    const item = salvos[index];
    
    salvos.splice(index, 1);
    
    const existente = carrinho.find(p => p.title === item.title);
    if (existente) {
      existente.quantidade += (item.quantidade || 1);
    } else {
      carrinho.push(item);
    }
    
    localStorage.setItem("carrinho", JSON.stringify(carrinho));
    localStorage.setItem("salvos", JSON.stringify(salvos));
    
    renderCarrinho();
    renderSalvos();
    atualizarContadoresTabs();
    mostrarSalvos(); // Garante que a visão (painel) é atualizada
  }

  // --- 5. LÓGICA DAS ABAS (Funções principais de visão) ---
  // ... (funções mostrarCarrinho() e mostrarSalvos() permanecem as mesmas) ...
  function mostrarCarrinho() {
    painelCarrinho.style.display = "block"; // Mostra painel carrinho
    painelSalvos.style.display = "none";   // Esconde painel salvos
    
    tabCarrinho.classList.add("active");
    tabSalvos.classList.remove("active");
    
    resumoContainer.style.display = "block"; // Mostra o resumo
    atualizarTotal(); // Atualiza o total (que pode ficar visível ou não)
  }

  function mostrarSalvos() {
    painelCarrinho.style.display = "none";  // Esconde painel carrinho
    painelSalvos.style.display = "block"; // Mostra painel salvos
    
    tabCarrinho.classList.remove("active");
    tabSalvos.classList.add("active");
    
    resumoContainer.style.display = "none"; // Esconde o resumo
  }

  tabCarrinho.addEventListener("click", mostrarCarrinho);
  tabSalvos.addEventListener("click", mostrarSalvos);


  // --- 6. AÇÃO DO BOTÃO "CONTINUAR" ---
  btnContinuar.addEventListener("click", function() {
      const usuarioLogado = localStorage.getItem("usuarioLogado");

      // 1. Calcula o total final com base no array 'carrinho'
      const totalCompra = carrinho.reduce((acc, p) => acc + (p.price * p.quantidade), 0);
      
      // 2. Salva o valor no localStorage para a próxima página ler
      localStorage.setItem("totalCompra", totalCompra.toFixed(2));
      
      // 3. Redireciona o usuário para a tela de entrega
      window.location.href = "tela_entrega.html";

      // Lógica de verificação de login (DESATIVADA) - Ainda é necessário a criação de tela_login
      // if (!usuarioLogado) {
      //   alert("Você precisa estar logado para continuar. Redirecionando...");
      //   window.location.href = "tela_login.html";
      
      // } else {
      //   // 1. Calcula o total final com base no array 'carrinho'
      //   const totalCompra = carrinho.reduce((acc, p) => acc + (p.price * p.quantidade), 0);
        
      //   // 2. Salva o valor no localStorage para a próxima página ler
      //   localStorage.setItem("totalCompra", totalCompra.toFixed(2));
        
      //   // 3. Redireciona o usuário para a tela de entrega
      //   window.location.href = "tela_entrega.html";
      // }
  });


  // --- 7. INICIALIZAÇÃO DA PÁGINA ---
  renderCarrinho();
  renderSalvos();
  atualizarContadoresTabs();
  
  // Define o estado inicial (mostra o carrinho e seu resumo)
  mostrarCarrinho();
</script>
</script> 

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      
      // --- A. INICIALIZA O SWIPER DE RECOMENDAÇÕES ---
      const swiper = new Swiper('.recomendacoes-swiper', {
        loop: false,
        spaceBetween: 18, 
        slidesPerView: 2, 
        breakpoints: {
          600: { slidesPerView: 3, spaceBetween: 10 },
          900: { slidesPerView: 4, spaceBetween: 15 },
          1100: { slidesPerView: 5, spaceBetween: 15 } 
        },
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
      });

      // --- B. LÓGICA DE CLIQUE DO CARD (Copiado de script.js) ---
      document.querySelectorAll(".recomendacoes-container a.card-link").forEach(link => {
        link.addEventListener("click", (event) => {
          
          const card = link.querySelector(".card");
          if (!card) return; 

          const title = card.querySelector(".title").innerText;
          const priceText = card.querySelector(".price").innerText;
          const priceValue = card.dataset.price; 
          const oldPrice = card.querySelector(".old")?.innerText || ""; 
          const badge = card.querySelector(".badge")?.innerText || ""; 
          
          const bgImg = card.querySelector(".thumb").style.backgroundImage;
          const imgMatch = bgImg.match(/url\(["']?(.*?)["']?\)/);
          const img = imgMatch ? imgMatch[1] : "";

          const produtoSelecionado = {
            title: title,
            price: priceText,
            priceValue: parseFloat(priceValue),
            oldPrice: oldPrice,
            badge: badge,
            img: img
          };
          
          localStorage.setItem("produtoSelecionado", JSON.stringify(produtoSelecionado));
        });
      });
      
      // --- C. LÓGICA DAS ESTRELAS (Copiado de script.js) ---
      const allCards = document.querySelectorAll(".recomendacoes-container .card");

      allCards.forEach(card => {
        const titleElement = card.querySelector(".title");
        const avaliacaoContainer = card.querySelector(".card-avaliacao");

        if (!titleElement || !avaliacaoContainer || !titleElement.innerText) {
          return; // Pula cards de modelo
        }
        
        const title = titleElement.innerText;
        const ratingKey = "rating_" + title; 
        const savedRating = localStorage.getItem(ratingKey);

        if (savedRating) {
          const rating = parseInt(savedRating);
          let starsHTML = "";
          for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
              starsHTML += '<span class="star filled">&#9733;</span>'; // Cheia
            } else {
              starsHTML += '<span class="star">&#9734;</span>'; // Vazia
            }
          }
          avaliacaoContainer.innerHTML = starsHTML;
        }
      });

    });
  </script>
  </body>
</html>